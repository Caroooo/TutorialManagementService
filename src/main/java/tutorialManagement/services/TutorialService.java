package tutorialManagement.services;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import tutorialManagement.api.mapper.TutorialChildStepMapper;
import tutorialManagement.api.mapper.TutorialMapper;
import tutorialManagement.api.mapper.TutorialStepMapper;
import tutorialManagement.api.model.TutorialChildStepCreateView;
import tutorialManagement.api.model.TutorialCreateView;
import tutorialManagement.api.model.TutorialStepCreateView;
import tutorialManagement.model.Resource;
import tutorialManagement.model.Tutorial;
import tutorialManagement.model.TutorialChildStep;
import tutorialManagement.model.TutorialStep;
import tutorialManagement.repositories.TutorialChildStepRepository;
import tutorialManagement.repositories.TutorialRepository;
import tutorialManagement.repositories.TutorialStepRepository;

import java.util.LinkedList;
import java.util.List;
import java.util.Optional;

@Service
public class TutorialService {

    @Autowired
    private TutorialRepository tutorialRepository;
    @Autowired
    private TutorialStepRepository tutorialStepRepository;
    @Autowired
    private TutorialChildStepRepository tutorialChildStepRepository;
    @Autowired
    private ResourceService resourceService;
    @Autowired
    private TutorialMapper tutorialMapper;
    @Autowired
    private TutorialChildStepMapper tutorialChildStepMapper;
    @Autowired
    private TutorialStepMapper tutorialStepMapper;

    public void addTutorial(TutorialCreateView tutorialCreateView){
        List<TutorialStep> steps = new LinkedList<>();
        for(TutorialStepCreateView tutorialStepCreateView : tutorialCreateView.getSteps()){
            TutorialStep tutorialStep = tutorialStepMapper.createViewToTutorialStep(tutorialStepCreateView);
            List<TutorialChildStep> childSteps = new LinkedList<>();
            for(TutorialChildStepCreateView childStepCreateView : tutorialStepCreateView.getTutorialChildSteps()){
                TutorialChildStep childStep = tutorialChildStepMapper.createViewToTutorialChildStep(childStepCreateView);
                Optional<tutorialManagement.model.Resource> resource = resourceService.getResourceById(childStepCreateView.getResourceId());
                if(resource.isPresent()){
                    childStep.setResource(resource.get());
                }
                childSteps.add(childStep);
            }
            tutorialStep.setTutorialChildSteps(childSteps);
            steps.add(tutorialStep);
        }
        Tutorial tutorial = new Tutorial();
        tutorial.setTitel(tutorialCreateView.getTitel());
        tutorial.setShortDescription(tutorialCreateView.getShortDescription());
        tutorial.setSteps(steps);
        tutorialRepository.save(tutorial);
    }

    public List<Tutorial> getTutorials(){

       // tutorialChildStep.setImage("data:image/png;base64,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");

      return tutorialRepository.findAll();
    }

    public Optional<Tutorial> getTutorialById(long id) {

        Optional<Tutorial> tutorial = tutorialRepository.findById(id);

        return  tutorial;
       //String audio = getAudioAsBase64("C:\\Users\\carom\\Documents\\FHV\\Master\\Angular-Projects\\resourcen\\sound.mp3");

    }


    public void setResourceToChildStep(long childStepId, long resourceId) {
        Optional<TutorialChildStep> childStep = tutorialChildStepRepository.findById(childStepId);
        Optional<Resource> resource = resourceService.getResourceById(resourceId);

        if(childStep.isPresent() && resource.isPresent()){
            childStep.get().setResource(resource.get());
            resource.get().setTutorialChildStep(childStep.get());
            tutorialChildStepRepository.save(childStep.get());
            resourceService.saveResource(resource.get());
        }
    }
}
